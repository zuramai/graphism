var E=Object.defineProperty;var B=(e,t,i)=>t in e?E(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var n=(e,t,i)=>(B(e,typeof t!="symbol"?t+"":t,i),i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function i(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=i(s);fetch(s.href,r)}})();var A=()=>({events:{},emit(e,...t){let i=this.events[e]||[];for(let o=0,s=i.length;o<s;o++)i[o](...t)},on(e,t){var i;return(i=this.events[e])!=null&&i.push(t)||(this.events[e]=[t]),()=>{var o;this.events[e]=(o=this.events[e])==null?void 0:o.filter(s=>t!==s)}}}),b=class{constructor(){n(this,"name","line");n(this,"isHovered",!1);n(this,"isSelected",!1);n(this,"moveFrom")}},M={backgroundColor:"white",borderColor:"#ddd",borderSize:2,shape:"circle",size:50,textColor:"#222",fontSize:16,hoverBorderSize:2,fontFamily:"Lora",hoverBorderColor:"rgba(120, 118, 240, .6)",hoverBackgroundColor:"white"},y=class extends b{constructor(t,i,o){super();n(this,"id");n(this,"neighbors",[]);n(this,"nodeConfig",{});n(this,"text");n(this,"position");n(this,"movable",!1);n(this,"isHovered",!1);n(this,"isSelected",!1);n(this,"mode","normal");n(this,"gCost",0);n(this,"_borderOffset",0);n(this,"parent",null);this.id=Math.floor(Math.random()*Date.now()),this.name="node",this.text=t,this.position=i,this.nodeConfig=Object.assign(this.nodeConfig,M),this.nodeConfig=Object.assign(this.nodeConfig,o)}addNeighbor(t,i,o){this.neighbors.find(s=>s.node===t)||this.neighbors.push({node:t,distance:i,line:o})}draw(t){t.beginPath(),t.arc(this.position.x,this.position.y,this.nodeConfig.size+5,0,Math.PI*2),t.strokeStyle=this.nodeConfig.hoverBorderColor,t.fillStyle=this.nodeConfig.hoverBackgroundColor,t.lineWidth=this.nodeConfig.hoverBorderSize,t.setLineDash(this.mode==="connecting"?[50,10]:[0]),t.lineDashOffset=this._borderOffset,this.isHovered&&!this.isSelected&&t.fill(),this.isSelected&&t.stroke(),t.closePath(),t.beginPath(),t.fillStyle=this.nodeConfig.backgroundColor,t.arc(this.position.x,this.position.y,this.nodeConfig.size,0,Math.PI*2),t.strokeStyle=this.nodeConfig.borderColor,t.lineWidth=this.nodeConfig.borderSize,t.stroke(),t.fill(),t.closePath(),t.fillStyle=this.nodeConfig.textColor,t.font=`${this.nodeConfig.fontSize}px ${this.nodeConfig.fontFamily}`,t.textBaseline="middle",t.textAlign="center",t.fillText(this.text,this.position.x,this.position.y)}update(){this._borderOffset++}select(){this.isSelected=!this.isSelected,this.isSelected||(this._borderOffset=0)}move(t,i){t&&(this.position.x=t),i&&(this.position.y=i),this.neighbors.forEach(o=>{o.line.updateDistance()})}isOnCoordinate(t){return t.x>this.position.x-this.nodeConfig.size&&t.x<=this.position.x+this.nodeConfig.size&&t.y>this.position.y-this.nodeConfig.size&&t.y<=this.position.y+this.nodeConfig.size}};function u(e,t){return Math.sqrt(Math.abs(e.x-t.x)**2+Math.abs(e.y-t.y)**2)}var w={color:"#777",width:5,hoverColor:"rgba(120, 118, 240, .6)",selectedColor:"#2f5ea8",text:null,dynamicDistance:!1},N=class extends b{constructor(t,i,o,s){super();n(this,"name","line");n(this,"lineConfig",w);n(this,"from");n(this,"to");n(this,"isHovered",!1);n(this,"isSelected",!1);n(this,"distance");this.lineConfig={...w,...s},this.from=t,this.to=i,this.distance=o}draw(t){t.strokeStyle=this.lineConfig.color,this.isSelected?t.strokeStyle=this.lineConfig.selectedColor:this.isHovered&&(t.strokeStyle=this.lineConfig.hoverColor),t.lineWidth=this.lineConfig.width,t.beginPath(),t.moveTo(this.from.position.x,this.from.position.y),t.lineTo(this.to.position.x,this.to.position.y),t.stroke(),t.closePath(),this.drawText(t)}drawText(t){const i={x:(this.from.position.x+this.to.position.x)/2,y:(this.from.position.y+this.to.position.y)/2};if(t.fillStyle=this.lineConfig.selectedColor,t.font="18px Arial bold",!this.lineConfig.text){if(this.distance===0)return;t.fillText(this.distance.toString(),i.x,i.y);return}t.fillText(this.lineConfig.text,i.x,i.y)}updateDistance(){this.lineConfig.dynamicDistance&&(this.distance=Math.round(u(this.from.position,this.to.position)))}move(t,i){}isOnCoordinate(t){return Math.ceil(u(this.from.position,t))+Math.ceil(u(this.to.position,t))===Math.ceil(u(this.from.position,this.to.position))}},_=class{constructor(){n(this,"endNode");n(this,"nodes",[]);n(this,"path",[]);n(this,"startNode");n(this,"progressStack",[])}solve(e){return[]}},O=class{constructor(){n(this,"findValue");n(this,"nodes",[]);n(this,"path",[]);n(this,"startNode");n(this,"progressStack",[])}solve(e){return[]}},P=class{constructor(){n(this,"findValue");n(this,"nodes",[]);n(this,"path",[]);n(this,"startNode");n(this,"progressStack",[])}solve(e){return[]}},F=class{constructor(e,t,i){n(this,"endNode");n(this,"nodes",[]);n(this,"path",[]);n(this,"startNode");n(this,"progressStack",[]);this.nodes=e,this.startNode=t,this.endNode=i}solve(){const e=this.startNode.id,t={},i={};this.nodes.forEach(r=>{i[r.id]=!1,t[r.id]={distance:r.id===e?0:1/0,parent:null}});let o=this.startNode;for(let r=0;r<Object.keys(i).length;r++){let d=1/0,l=null;o.neighbors.forEach(a=>{!i[a.node.id]&&a.distance+t[o.id].distance<t[a.node.id].distance&&(t[a.node.id].distance=a.distance+t[o.id].distance,t[a.node.id].parent=o.id,t[a.node.id].line=a.line),a.distance<d&&(l=a,d=l.distance)}),i[o.id]=!0,o=l.node}this.path=[this.endNode,t[this.endNode.id].line];let s=t[this.endNode.id].parent;for(;s;){const r=this.nodes.find(d=>d.id===s);this.path.push(r),this.path.push(t[s].line),s=t[s].parent}return this.path.reverse()}},I=class{constructor(){n(this,"nodes",[]);n(this,"path",[]);n(this,"startNode");n(this,"progressStack",[])}solve(e){return[]}},z=class{constructor(){n(this,"nodes",[]);n(this,"path",[]);n(this,"startNode");n(this,"progressStack",[])}solve(e){return[]}},D={aStar:_,bfs:O,dfs:P,dijkstra:F,prim:z,kruskal:I};function T(e,t,i,o){return new D[e](t,i,o)}function c(e,t,i){const o="http://www.w3.org/2000/svg",s=document.createElementNS(o,e);for(const r in t)s.setAttribute(r,t[r]);return i&&i(s),s}var H=class{constructor(e,t){n(this,"ctx");n(this,"type","grid");n(this,"grid");this.ctx=e,this.type=t,this.type==="grid"&&this.createGrid()}createGrid(){const e=c("svg",{xmlns:"http://www.w3.org/2000/svg"},d=>{const l=c("defs",{},a=>{const k=c("pattern",{id:"smallGrid",width:"8",height:"8",patternUnits:"userSpaceOnUse"},g=>{const p=c("path",{d:"M 8 0 L 0 0 0 8",fill:"none",stroke:"rgb(203 213 225)","stroke-width":".5"});g.append(p)}),x=c("pattern",{id:"grid",width:"80",height:"80",patternUnits:"userSpaceOnUse"},g=>{const p=c("rect",{width:"80",height:"80",fill:"url(#smallGrid)"}),L=c("path",{d:"M 80 0 L 0 0 0 80",fill:"none",stroke:"rgb(148 163 184)","stroke-width":".5"});g.append(p),g.append(L)});a.append(k),a.append(x)});d.append(c("rect",{width:"100%",height:"100%",fill:"url(#grid)"})),d.appendChild(l)});e.setAttribute("width",document.body.clientWidth.toString()),e.setAttribute("height",document.body.clientHeight.toString());const t=new XMLSerializer().serializeToString(e),i=btoa(t),s="data:image/svg+xml;base64,"+i,r=new Image;r.src=s,this.grid=r,console.log(r),this.ctx.drawImage(r,0,0,this.ctx.canvas.width,this.ctx.canvas.height)}draw(){const e=this.ctx.canvas;if(this.type==="grid"){this.ctx.drawImage(this.grid,0,0,e.width,e.height);return}typeof this.type=="string"||this.type instanceof CanvasPattern?(this.ctx.fillStyle=this.type,this.ctx.fillRect(0,0,e.width,e.height)):this.type instanceof HTMLImageElement&&this.ctx.drawImage(this.type,0,0,e.width,e.height)}},q=(e,t)=>new H(e,t),G={lineColor:"#555",nodeBackground:"white",nodeTextColor:"#555",canvasBackground:"#ccc",grid:!0},$=class{constructor(e={}){n(this,"canvas");n(this,"ctx");n(this,"nodes",[]);n(this,"lines",[]);n(this,"selectedNode",[]);n(this,"holdingNode",null);n(this,"background");n(this,"dragFrom");n(this,"isDirectedGraph",!1);n(this,"mode","normal");n(this,"_hoveredElement",null);n(this,"_emitter",A());n(this,"_runningBorderOffset",0);this.config=e,this.config=Object.assign(G,e),this.mount(e.el),this.background=q(this.ctx,"grid")}resolveSelector(e){return typeof e=="string"?document.querySelector(e):e||null}mount(e){if(this.canvas)throw new Error("[graphism] already mounted, unmount previous target first");if(this.canvas=this.resolveSelector(e),!this.canvas)throw new Error("[graphism] target element not found");this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,window.addEventListener("keydown",this.keypress.bind(this)),this.canvas.addEventListener("mousedown",this.mouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.mouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.mouseUp.bind(this)),this.canvas.addEventListener("click",this.mouseClick.bind(this)),this._emitter.emit("mounted"),requestAnimationFrame(()=>this.render())}on(e,t,i=!1){const o=this._emitter.on(e,(...s)=>{i&&o(),t(...s)});return o}generateGraph(){const e=this.createNode("a",{x:300,y:300}),t=this.createNode("b",{x:500,y:450}),i=this.createNode("c",{x:550,y:200}),o=this.createNode("d",{x:200,y:500}),s=this.createNode("e",{x:700,y:420}),r=this.createNode("f",{x:1e3,y:420}),d=this.createNode("g",{x:500,y:620}),l=this.createNode("h",{x:800,y:300});this.addNodeNeighbor(e,t,100),this.addNodeNeighbor(e,i,150),this.addNodeNeighbor(e,o,250),this.addNodeNeighbor(t,s,50),this.addNodeNeighbor(i,s,250),this.addNodeNeighbor(r,s,250),this.addNodeNeighbor(d,o,1250),this.addNodeNeighbor(d,s,300),this.addNodeNeighbor(d,r,400),this.addNodeNeighbor(i,l,300),this.addNodeNeighbor(l,r,250),this.addNodeNeighbor(l,s,200)}draw(){this.drawBackground(),this.drawMode(),this.drawLines(),this.drawNodes()}drawLines(){for(let e=0;e<this.lines.length;e++)this.lines[e].draw(this.ctx)}drawNodes(){for(let e=0;e<this.nodes.length;e++)this.nodes[e].draw(this.ctx)}drawBackground(){this.background.draw()}drawMode(){["creating","connecting"].includes(this.mode)&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.strokeStyle="rgb(120, 118, 240)",this.ctx.rect(0,0,this.canvas.width,this.canvas.height),this.ctx.lineWidth=10,this.ctx.setLineDash([0,25,50]),this.ctx.lineDashOffset=this._runningBorderOffset,this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore())}waitingForClick(){return new Promise(e=>{this.mode="creating",this.canvas.addEventListener("click",t=>{const i=this.getCursorPosition(t);e(i)},{once:!0})})}createNode(e,t,i){const o=new y(e,t,i);return this.nodes.push(o),this._emitter.emit("node:created",o),this.setMode("normal"),this.clearSelectedNode(),o}clear(){this.lines=[],this.nodes=[],this.mode="normal"}clearSelectedNode(){for(let e=0;e<this.nodes.length;e++)this.nodes[e].isSelected=!1,this.nodes[e].mode="normal",this.nodes[e].movable=!1;this._emitter.emit("node:clearSelect"),this.selectedNode=[]}clearSelectedLine(){for(let e=0;e<this.lines.length;e++)this.lines[e].isSelected=!1;this._emitter.emit("line:clearSelect"),this.selectedNode=[]}runAlgorithm(e,t,i){const s=T(e,this.nodes,t,i).solve();console.log(s),s.forEach(r=>{r instanceof N?r.lineConfig.color="blue":r instanceof y&&(r.nodeConfig.backgroundColor="blue",r.nodeConfig.textColor="white")})}setMode(e){this.mode=e,this.clearSelectedNode()}getSelectedNode(){return this.selectedNode}addNodeNeighbor(e,t,i){let o;const s={};i==null&&(s.dynamicDistance=!0),i!=null||(i=Math.round(u(e.position,t.position)));const r=this.lines.find(d=>d.from===e&&d.to===t||d.from===t&&d.to===e);r?o=r:(o=new N(e,t,i,s),this.lines.push(o)),e.addNeighbor(t,i,o),this.isDirectedGraph||t.addNeighbor(e,i,o),this._emitter.emit("node:connect",e,t)}update(){for(let e=0;e<this.nodes.length;e++)this.nodes[e].update();["creating","connecting"].includes(this.mode)&&this._runningBorderOffset++}keypress(e){switch(console.log("keypress"),e.key){case"a":e.preventDefault(),e.ctrlKey&&this.selectAllNode();break}}mouseUp(){this.holdingNode=null}mouseDown(e){const t=this.getCursorPosition(e);this.dragFrom=t;for(let i=0;i<this.nodes.length;i++){const o=this.nodes[i];if(o.isOnCoordinate(t)){this.holdingNode=o,o.moveFrom={x:o.position.x,y:o.position.y};for(let s=0;s<this.selectedNode.length;s++){const r=this.selectedNode[s];r.moveFrom={x:r.position.x,y:r.position.y}}}}}mouseMove(e){const t=this.getCursorPosition(e);let i;const o=[...this.nodes,...this.lines];if(this._hoveredElement!=null&&(this._hoveredElement.isHovered=!1,this._hoveredElement=null),this.canvas.style.cursor="grab",(i=o.find(d=>d.isOnCoordinate(t)))&&(this.canvas.style.cursor="pointer",this._emitter.emit(`${i.name}:mouseover`,i),this._hoveredElement=i,i.isHovered=!0),!this.nodes.length||!this.holdingNode)return;const s=t.x-this.dragFrom.x,r=t.y-this.dragFrom.y;if(this.selectedNode.length>1&&this.holdingNode.isSelected)for(let d=0;d<this.selectedNode.length;d++)i=this.nodes[d],i.move(i.moveFrom.x+s,i.moveFrom.y+r);else i.move(i.moveFrom.x+s,i.moveFrom.y+r)}mouseClick(e){const t=this.getCursorPosition(e);if(t.x===this.dragFrom.x&&t.y===this.dragFrom.y){this._emitter.emit("canvas:click",t);let i=!1,o=!1;for(let s=this.nodes.length-1;s>=0;s--){const r=this.nodes[s];if(r.isOnCoordinate(t)){e.ctrlKey||this.clearSelectedNode(),this.selectNode(r,this.mode),i=!0,this._emitter.emit("node:select",r);break}}for(let s=0;s<this.lines.length;s++){const r=this.lines[s];r.isOnCoordinate(t)&&(r.isSelected=!0,o=!0,this._emitter.emit("line:select",r))}o||this.clearSelectedLine(),i||this.clearSelectedNode()}}selectNode(e,t="normal"){e.select(),e.mode=e.isSelected?t:"normal",this.selectedNode.push(e)}selectAllNode(){for(let e=0;e<this.nodes.length;e++)this.selectNode(this.nodes[e])}getCursorPosition(e){const t=this.canvas.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}}render(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.draw(),this.update(),requestAnimationFrame(()=>this.render())}};function j(e){return new $(e)}function W(e){const t=document.createElement("a");t.setAttribute("download","graphism.png"),e.toBlob(i=>{const o=URL.createObjectURL(i);t.setAttribute("href",o),t.click()})}const C=e=>e.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`),h=(e,t)=>document.getElementById(e).addEventListener("click",t);function U(e,t,i=2e3){const o=document.createElement("div");o.classList.add("notification"),o.classList.add(`notification-${e}`),o.innerText=t;const s=document.createElement("button"),r=document.createElementNS("http://www.w3.org/2000/svg","svg"),d=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("width","16"),r.setAttribute("height","16"),d.setAttribute("d","M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"),r.appendChild(d),s.appendChild(r),o.appendChild(s);const l=document.querySelector(".notifications");l.appendChild(o),setTimeout(()=>l.removeChild(o),i),s.addEventListener("click",()=>{l.removeChild(o)},{once:!0})}window.addEventListener("DOMContentLoaded",()=>{R(),K()});function R(){document.querySelectorAll(".modal").forEach(t=>{t.querySelector(".modal-close").addEventListener("click",()=>{t.classList.remove("modal-open")})})}function K(){const e=document.querySelectorAll(".sidebar-item");for(let t=0;t<e.length;t++){const i=e[t];i.querySelector(".sidebar-group-icon").addEventListener("click",()=>{e.forEach(o=>o!==i&&o.classList.remove("sidebar-item-open")),i.classList.toggle("sidebar-item-open")})}}function V(e,t){t.addEventListener("click",()=>{e.classList.toggle("modal-open")})}function X(e,t){const i=document.getElementById(e);return t.y+i.clientHeight>document.body.clientHeight&&(t.y-=i.clientHeight),t.x+i.clientWidth>document.body.clientWidth&&(t.x-=i.clientWidth),i.style.left=`${t.x}px`,i.style.top=`${t.y}px`,i.style.visibility="visible",i}const Y={fontSize:22,fontFamily:"Lora",textColor:"#222",backgroundColor:"white",borderColor:"#ddd",borderSize:2,width:50,height:50,hoverBorderColor:"rgba(120, 118, 240, .6)",hoverBackgroundColor:"white"};window.onload=()=>{const e=document.querySelector("#canvas"),t=j({el:e,canvasBackground:"#efefef"}),i=se(t,Y);ne(i),t.generateGraph(),Z(t,e)};function Z(e,t){window.addEventListener("resize",oe.bind(null,t)),h("node-add",Q.bind(null,e)),h("generate-graph",te.bind(null,e)),h("create-new",ie),h("connectNode",ee.bind(null,e)),h("saveToImage",()=>W(t)),h("clear",()=>e.clear()),V(document.querySelector(".modal-add"),document.getElementById("openAddModal")),J(e),e.on("line:select",()=>{document.getElementById("options-line").classList.remove("disabled")}),e.on("line:clearSelect",()=>{document.getElementById("options-line").classList.add("disabled")})}function J(e){h("solve-dijkstra",()=>{e.setMode("connecting"),m("Select starting node.."),e.clearSelectedNode(),e.on("node:select",t=>{m("Select ending node.."),e.on("node:select",i=>{e.runAlgorithm("dijkstra",t,i),v(),e.setMode("normal")},!0)},!0)})}function Q(e){const t=document.getElementById("name");document.querySelector(".modal-add").classList.remove("modal-open"),m(`Click anywhere to create ${t.value} node`),e.setMode("creating"),e.on("canvas:click",i=>{const o=t?t.value:"";e.createNode(o,i),U("success",`Node ${o} created`),v()},!0)}function ee(e){e.setMode("connecting"),m("Click any node to connect"),e.clearSelectedNode(),e.on("node:select",t=>{e.on("node:select",i=>{const o=X("poppover-distance",{x:i.position.x,y:i.position.y});o.querySelector("form").addEventListener("submit",r=>{r.preventDefault();const d=document.getElementById("distance-value").value;e.addNodeNeighbor(t,i,d===""?null:~~d),e.clearSelectedNode(),e.setMode("normal"),o.style.visibility="hidden"},{once:!0})},!0)},!0),e.on("node:connect",()=>{v()},!0)}function te(e){e.generateGraph(),S()}function ie(){S()}function S(){document.querySelector(".page-title").classList.toggle("show")}const f=document.getElementById("helper-text");function m(e,t=!0){t&&f.classList.add("blinking"),f.innerText=e,f.classList.add("show")}function v(){f.classList.remove("blinking"),f.classList.remove("show")}function oe(e){e.width=window.innerWidth,e.height=window.innerHeight,e.setAttribute("width",e.width.toString()),e.setAttribute("height",e.height.toString())}function se(e,t){return new Proxy(t,{set(i,o,s){i[o]=s;const r=document.getElementById(`custom-${C(o)}`);return r.value=s,e.getSelectedNode()[0].nodeConfig[o]=s,!0}})}function ne(e){Object.keys(e).forEach(t=>{let i=document.getElementById(`custom-${C(t)}`);i||(i=document.querySelector(t)),i.addEventListener("input",()=>e[t]=i.value)})}
