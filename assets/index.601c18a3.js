var p=Object.defineProperty;var C=(t,e,i)=>e in t?p(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var r=(t,e,i)=>(C(t,typeof e!="symbol"?e+"":e,i),i);const y=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}};y();var g=class{constructor(){r(this,"name","line");r(this,"isHovered",!1);r(this,"isSelected",!1);r(this,"moveFrom")}},w={backgroundColor:"white",borderColor:"#ddd",borderSize:2,shape:"circle",size:50,textColor:"#222",fontSize:16,hoverBorderSize:2,fontFamily:"Lora",hoverBorderColor:"rgba(120, 118, 240, .6)",hoverBackgroundColor:"white"},b=class extends g{constructor(e,i,o){super();r(this,"neighbors",[]);r(this,"nodeConfig",{});r(this,"text");r(this,"position");r(this,"movable",!1);r(this,"isHovered",!1);r(this,"isSelected",!1);r(this,"mode","normal");r(this,"gCost",0);r(this,"_borderOffset",0);r(this,"parent",null);this.name="node",this.text=e,this.position=i,this.nodeConfig=Object.assign(this.nodeConfig,w),this.nodeConfig=Object.assign(this.nodeConfig,o)}addNeighbor(e,i,o){this.neighbors.find(n=>n.node==e)||this.neighbors.push({node:e,distance:i,line:o})}draw(e){e.beginPath(),e.arc(this.position.x,this.position.y,this.nodeConfig.size+5,0,Math.PI*2),e.strokeStyle=this.nodeConfig.hoverBorderColor,e.fillStyle=this.nodeConfig.hoverBackgroundColor,e.lineWidth=this.nodeConfig.hoverBorderSize,e.setLineDash(this.mode=="connecting"?[50,10]:[0]),e.lineDashOffset=this._borderOffset,this.isHovered&&!this.isSelected&&e.fill(),this.isSelected&&e.stroke(),e.closePath(),e.beginPath(),e.fillStyle=this.nodeConfig.backgroundColor,e.arc(this.position.x,this.position.y,this.nodeConfig.size,0,Math.PI*2),e.strokeStyle=this.nodeConfig.borderColor,e.lineWidth=this.nodeConfig.borderSize,e.stroke(),e.fill(),e.closePath(),e.fillStyle=this.nodeConfig.textColor,e.font=`${this.nodeConfig.fontSize}px ${this.nodeConfig.fontFamily}`,e.textBaseline="middle",e.textAlign="center",e.fillText(this.text,this.position.x,this.position.y)}update(){this._borderOffset++}select(){this.isSelected=!this.isSelected,this.isSelected||(this._borderOffset=0)}move(e,i){e&&(this.position.x=e),i&&(this.position.y=i)}isOnCoordinate(e){return e.x>this.position.x-this.nodeConfig.size&&e.x<=this.position.x+this.nodeConfig.size&&e.y>this.position.y-this.nodeConfig.size&&e.y<=this.position.y+this.nodeConfig.size}},S=()=>({events:{},emit(t,...e){(this.events[t]||[]).forEach(i=>i(...e))},on(t,e){return(this.events[t]=this.events[t]||[]).push(e),()=>this.events[t]=(this.events[t]||[]).filter(i=>i!==e)}});function c(t,e){return Math.sqrt(Math.abs(t.x-e.x)**2+Math.abs(t.y-e.y)**2)}var u={color:"#777",width:5,hoverColor:"rgba(120, 118, 240, .6)",selectedColor:"#2f5ea8",text:""},N=class extends g{constructor(e,i,o){super();r(this,"name","line");r(this,"lineConfig",u);r(this,"from");r(this,"to");r(this,"isHovered",!1);r(this,"isSelected",!1);this.lineConfig=Object.assign(u,o),this.from=e,this.to=i}draw(e){e.strokeStyle=this.lineConfig.color,this.isSelected?e.strokeStyle=this.lineConfig.selectedColor:this.isHovered&&(e.strokeStyle=this.lineConfig.hoverColor),e.lineWidth=this.lineConfig.width,e.beginPath(),e.moveTo(this.from.position.x,this.from.position.y),e.lineTo(this.to.position.x,this.to.position.y),e.stroke(),e.closePath()}move(e,i){}isOnCoordinate(e){return Math.ceil(c(this.from.position,e))+Math.ceil(c(this.to.position,e))==Math.ceil(c(this.from.position,this.to.position))}},L={lineColor:"#555",nodeBackground:"white",nodeTextColor:"#555",canvasBackground:"#ccc"},k=class{constructor(t={}){r(this,"canvas");r(this,"ctx");r(this,"nodes",[]);r(this,"dragFrom");r(this,"isDirectedGraph",!1);r(this,"lines",[]);r(this,"selectedNode",[]);r(this,"holdingNode",null);r(this,"mode","normal");r(this,"_hoveredElement",null);r(this,"_emitter",S());r(this,"_runningBorderOffset",0);this.config=t,this.config=Object.assign(L,t),this.mount(t.el)}resolveSelector(t){return typeof t=="string"?document.querySelector(t):t||null}mount(t){if(this.canvas)throw new Error("[graphism] already mounted, unmount previous target first");if(this.canvas=this.resolveSelector(t),!this.canvas)throw new Error("[graphism] target element not found");this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.canvas.addEventListener("mousedown",this.mouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.mouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.mouseUp.bind(this)),this.canvas.addEventListener("click",this.mouseClick.bind(this)),this._emitter.emit("mounted"),requestAnimationFrame(()=>this.render())}on(t,e,i=!1){const o=this._emitter.on(t,(...n)=>{i&&o(),e(...n)});return o}generateGraph(){const t=this.createNode("Jakarta",{x:130,y:274}),e=this.createNode("Bandung",{x:390,y:200});this.addNodeNeighbor(e,t,100),this.addNodeNeighbor(t,e,100);const i=[t,e];return this.nodes=i,i}draw(){this.drawBackground(),this.drawLines(),this.drawNodes()}drawLines(){for(let t=0;t<this.lines.length;t++)this.lines[t].draw(this.ctx)}drawNodes(){for(let t=0;t<this.nodes.length;t++)this.nodes[t].draw(this.ctx)}drawBackground(){typeof this.config.canvasBackground=="string"||this.config.canvasBackground instanceof CanvasPattern?(this.ctx.fillStyle=this.config.canvasBackground,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)):this.config.canvasBackground instanceof HTMLImageElement&&this.ctx.drawImage(this.config.canvasBackground,0,0,this.canvas.width,this.canvas.height),["creating","connecting"].includes(this.mode)&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.strokeStyle="rgb(120, 118, 240)",this.ctx.rect(0,0,this.canvas.width,this.canvas.height),this.ctx.lineWidth=10,this.ctx.setLineDash([0,25,50]),this.ctx.lineDashOffset=this._runningBorderOffset,this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore())}waitingForClick(){return new Promise(t=>{this.mode="creating",this.canvas.addEventListener("click",e=>{let i=this.getCursorPosition(e);t(i)},{once:!0})})}createNode(t,e,i){let o=new b(t,e,i);return this.nodes.push(o),this._emitter.emit("node:created",o),this.setMode("normal"),this.clearSelectedNode(),console.log("creating new node ",t," at ",e),o}clearSelectedNode(){for(let t=0;t<this.nodes.length;t++)this.nodes[t].isSelected=!1,this.nodes[t].mode="normal",this.nodes[t].movable=!1;this._emitter.emit("node:clearSelect"),this.selectedNode=[],console.log("clearing selected node")}clearSelectedLine(){for(let t=0;t<this.lines.length;t++)this.lines[t].isSelected=!1;this._emitter.emit("line:clearSelect"),this.selectedNode=[],console.log("clearing selected line")}setMode(t){switch(this.mode=t,t){case"connecting":this.clearSelectedNode(),this.on("node:select",e=>{this.on("node:select",i=>{this.addNodeNeighbor(e,i,0),this.clearSelectedNode(),this.mode="normal"},!0)},!0);break}}addNodeNeighbor(t,e,i){let o,n=this.lines.find(s=>s.from==t&&s.to==e||s.from==e&&s.to==t);n?o=n:(o=new N(t,e,{}),this.lines.push(o)),t.addNeighbor(e,i,o),this.isDirectedGraph||e.addNeighbor(t,i,o),this._emitter.emit("node:connect",t,e)}update(){for(let t=0;t<this.nodes.length;t++)this.nodes[t].update();["creating","connecting"].includes(this.mode)&&this._runningBorderOffset++}mouseUp(){this.holdingNode=null,console.log("Mouseup ",this.selectedNode)}mouseDown(t){let e=this.getCursorPosition(t);console.log("mousedown"),this.dragFrom=e;for(let i=0;i<this.nodes.length;i++){let o=this.nodes[i];if(o.isOnCoordinate(e)){this.holdingNode=o,o.moveFrom={x:o.position.x,y:o.position.y};for(let n=0;n<this.selectedNode.length;n++){let s=this.selectedNode[n];s.moveFrom={x:s.position.x,y:s.position.y}}}}}mouseMove(t){let e=this.getCursorPosition(t),i,o=[...this.nodes,...this.lines];if(this._hoveredElement!=null&&(this._hoveredElement.isHovered=!1,this._hoveredElement=null),this.canvas.style.cursor="grab",(i=o.find(l=>l.isOnCoordinate(e)))&&(this.canvas.style.cursor="pointer",this._emitter.emit(`${i.name}:mouseover`,i),this._hoveredElement=i,i.isHovered=!0),!this.nodes.length||!this.holdingNode)return;let n=e.x-this.dragFrom.x,s=e.y-this.dragFrom.y;if(this.selectedNode.length>1&&this.holdingNode.isSelected)for(let l=0;l<this.selectedNode.length;l++)i=this.nodes[l],i.move(i.moveFrom.x+n,i.moveFrom.y+s);else i.move(i.moveFrom.x+n,i.moveFrom.y+s)}mouseClick(t){let e=this.getCursorPosition(t);if(e.x==this.dragFrom.x&&e.y==this.dragFrom.y){this._emitter.emit("canvas:click",e);let i=!1,o=!1;for(let n=this.nodes.length-1;n>=0;n--){let s=this.nodes[n];if(s.isOnCoordinate(e)){t.ctrlKey||this.clearSelectedNode(),this.selectNode(s,this.mode),i=!0,this._emitter.emit("node:select",s);break}}for(let n=0;n<this.lines.length;n++){let s=this.lines[n];s.isOnCoordinate(e)&&(s.isSelected=!0,o=!0,this._emitter.emit("line:select",s))}o||this.clearSelectedLine(),i||this.clearSelectedNode()}}selectNode(t,e="normal"){t.select(),t.mode=t.isSelected?e:"normal",this.selectedNode.push(t)}getCursorPosition(t){let e=this.canvas.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}render(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.draw(),this.update(),requestAnimationFrame(()=>this.render())}};function E(t){return new k(t)}const h=t=>t.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`);function x(t,e,i=2e3){let o=document.createElement("div");o.classList.add("notification"),o.classList.add(`notification-${t}`),o.innerText=e;let n=document.createElement("button"),s=document.createElementNS("http://www.w3.org/2000/svg","svg"),l=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("width","16"),s.setAttribute("height","16"),l.setAttribute("d","M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"),s.appendChild(l),n.appendChild(s),o.appendChild(n);let a=document.querySelector(".notifications");a.appendChild(o),setTimeout(()=>a.removeChild(o),i),n.addEventListener("click",()=>{a.removeChild(o)},{once:!0})}window.addEventListener("DOMContentLoaded",()=>{B(),O()});function B(){document.querySelectorAll(".modal").forEach(e=>{e.querySelector(".modal-close").addEventListener("click",o=>{e.classList.remove("modal-open")})})}function O(){let t=document.querySelectorAll(".sidebar-item");for(let e=0;e<t.length;e++){let i=t[e];i.querySelector(".sidebar-group-icon").addEventListener("click",()=>{t.forEach(o=>o!==i&&o.classList.remove("sidebar-item-open")),i.classList.toggle("sidebar-item-open")})}}function _(t,e){e.addEventListener("click",i=>{t.classList.toggle("modal-open")})}function F(t){let e=document.createElement("a");e.setAttribute("download","graphism.png"),t.toBlob(function(i){let o=URL.createObjectURL(i);e.setAttribute("href",o),e.click()})}let M={fontSize:22,fontFamily:"Lora",textColor:"#222",backgroundColor:"white",borderColor:"#ddd",borderSize:2,width:50,height:50,hoverBorderColor:"rgba(120, 118, 240, .6)",hoverBackgroundColor:"white"};window.onload=()=>{const t=document.querySelector("#canvas"),e=E({el:t,canvasBackground:"#efefef"});let i=H(e,M);$(i);let o=e.createNode("ASC",{x:300,y:300}),n=e.createNode("WSC",{x:700,y:400});e.addNodeNeighbor(o,n,100),P(e,t)};function P(t,e){window.addEventListener("resize",T.bind(null,e)),document.getElementById("node-add").addEventListener("click",z.bind(null,t)),document.getElementById("generate-graph").addEventListener("click",q.bind(null,t)),document.getElementById("create-new").addEventListener("click",A),document.getElementById("connectNode").addEventListener("click",I.bind(null,t)),document.getElementById("saveToImage").addEventListener("click",()=>F(e)),_(document.querySelector(".modal-add"),document.getElementById("openAddModal")),t.on("line:select",i=>{console.log("line selected"),document.getElementById("options-line").classList.remove("disabled")}),t.on("line:clearSelect",()=>{console.log("line clearerd"),document.getElementById("options-line").classList.add("disabled")})}function z(t){let e=document.getElementById("name");document.querySelector(".modal-add").classList.remove("modal-open"),m(`Click anywhere to create ${e.value} node`),t.setMode("creating"),t.on("canvas:click",i=>{let o=e?e.value:"";t.createNode(o,i),x("success",`Node ${o} created`),v()},!0)}function I(t){t.setMode("connecting"),m("Click any node to connect"),t.on("node:connect",()=>{v()},!0)}function q(t){const e=t.generateGraph();t.nodes=e,f()}function A(){f()}function f(){document.querySelector(".page-title").classList.toggle("show")}const d=document.getElementById("helper-text");function m(t,e=!0){e&&d.classList.add("blinking"),d.innerText=t,d.classList.add("show")}function v(){d.classList.remove("blinking"),d.classList.remove("show")}function T(t){t.width=window.innerWidth,t.height=window.innerHeight,t.setAttribute("width",t.width.toString()),t.setAttribute("height",t.height.toString())}function H(t,e){return new Proxy(e,{set(i,o,n){i[o]=n;let s=document.getElementById(`custom-${h(o)}`);return s.value=n,console.log("Changing: ",t.selectedNode[0]),t.selectedNode[0].nodeConfig[o]=n,!0}})}function $(t){Object.keys(t).forEach(e=>{console.log(`querying: custom-${h(e)}`);let i=document.getElementById(`custom-${h(e)}`);i||(i=document.querySelector(e)),i.addEventListener("input",()=>t[e]=i.value)})}
